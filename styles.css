/* Import Google Fonts (including 'Inter' from the calculator's theme) */
@import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Noto+Sans+Sinhala:wght@400;500;600;700&family=Poppins:wght@400;500;600;700&display=swap');

/* --- NEW ORANGE THEME VARIABLES --- */
:root {
    /* Light Theme */
    --bg-light: #fff8f0; /* Warm Cream */
    --text-light: #4b3c31; /* Dark Warm Brown */
    --card-bg-light: rgba(255, 255, 255, 0.6);
    --border-light: rgba(221, 194, 161, 0.6);
    --header-text-light: #3d2f26;
    --input-bg-light: rgba(255, 255, 255, 0.4);
    --input-placeholder-light: #b8a699;
    --button-text-light: #fff;

    /* Shared Colors & Gradients */
    --gradient-start: #ff9a4c; /* Bright Orange */
    --gradient-end: #ff6a4c;   /* Reddish Orange */
    --gradient-danger-start: #f43f5e; /* Rose */
    --gradient-danger-end: #ef4444;   /* Red */
    --gradient-angle: 120deg;
}

.dark {
    /* Dark Theme (Warm Amber/Brown) */
    --bg-dark: #291d13;
    --text-dark: #e0c9b6;
    --card-bg-dark: rgba(41, 29, 19, 0.5);
    --border-dark: rgba(87, 69, 52, 0.5);
    --header-text-dark: #f5e5d5;
    --input-bg-dark: rgba(41, 29, 19, 0.5);
    --input-placeholder-dark: #8f7e70;
}
/* --- END OF THEME VARIABLES --- */

html {
    color-scheme: light dark;
    scroll-behavior: smooth;
}

body {
    font-family: 'Inter', 'Poppins', 'Noto Sans Sinhala', sans-serif;
    color: var(--text-light);
    transition: background-color 0.4s ease, color 0.4s ease;
    position: relative;
    overflow: hidden; /* For animated background */
}

/* Animated Gradient Background from CalCSS */
/* body::before {
    content: '';
    position: absolute;
    top: 50%;
    left: 50%;
    width: 150%;
    height: 150%;
    background: linear-gradient(var(--gradient-angle), var(--gradient-start), var(--gradient-end));
    opacity: 0.15;
    transform: translate(-50%, -50%);
    animation: rotate-background 35s linear infinite;
    z-index: -1;
}*/
.dark body::before {
    opacity: 0.2;
}

.dark body {
    color: var(--text-dark);
}

/* Enhanced Glassmorphism Effect for Cards and Modals */
.glass-card, .modal-content, .card {
    background-color: var(--card-bg-light);
    backdrop-filter: blur(20px);
    -webkit-backdrop-filter: blur(20px);
    border: 1px solid var(--border-light);
    box-shadow: 0 16px 40px rgba(0, 0, 0, 0.1);
    border-radius: 1.5rem;
}
.dark .glass-card, .dark .modal-content, .dark .card {
    background-color: var(--card-bg-dark);
    border: 1px solid var(--border-dark);
    box-shadow: 0 16px 60px rgba(0, 0, 0, 0.2);
}

.glass-input {
    background-color: var(--input-bg-light);
    border: 1px solid var(--border-light);
    color: var(--text-light);
    transition: border-color 0.3s ease, box-shadow 0.3s ease;
}
.dark .glass-input {
    background-color: var(--input-bg-dark);
    border: 1px solid var(--border-dark);
    color: var(--text-dark);
}
.glass-input::placeholder {
    color: var(--input-placeholder-light);
}
.dark .glass-input::placeholder {
    color: var(--input-placeholder-dark);
}

/* Improved Focus Style from CalCSS */
.glass-input:focus {
    outline: none;
    border-color: var(--gradient-start);
    box-shadow: 0 0 0 3px color-mix(in srgb, var(--gradient-start) 20%, transparent);
}

.card {
    transition: transform 0.3s ease, box-shadow 0.3s ease;
    animation: floatUp 0.6s cubic-bezier(0.25, 1, 0.5, 1) forwards;
    opacity: 0;
}

.card:hover {
    transform: translateY(-8px);
    box-shadow: 0 10px 20px rgba(0, 0, 0, 0.15);
}

.card[data-subject-color] {
    border-image: linear-gradient(to top, var(--subject-color, transparent), transparent) 1;
    border-width: 0 0 0 4px;
    border-style: solid;
}

.completed { opacity: 0.10; }
.completed .day-title { text-decoration: line-through; text-decoration-color: var(--gradient-end); text-decoration-thickness: 2px; }

.lesson-entry {
    background-color: rgba(0, 0, 0, 0.03);
    border-radius: 0.75rem;
    border: 1px solid transparent;
    cursor: grab;
    transition: background-color 0.2s;
}
.dark .lesson-entry {
    background-color: rgba(255, 255, 255, 0.04);
}
.lesson-entry:hover {
    background-color: rgba(0, 0, 0, 0.05);
    border-color: var(--border-light);
}
.dark .lesson-entry:hover {
    background-color: rgba(255, 255, 255, 0.07);
    border-color: var(--border-dark);
}
.lesson-entry:active { cursor: grabbing; }
.dragging { opacity: 0.5; border: 2px dashed var(--gradient-start); }

.header-text {
    background-image: linear-gradient(var(--gradient-angle), var(--gradient-start), var(--gradient-end));
    -webkit-background-clip: text;
    background-clip: text;
    color: transparent;
}
/* In dark mode, the header text is a solid color for better contrast */
.dark .header-text {
    background-image: none;
    -webkit-background-clip: unset;
    background-clip: unset;
    color: var(--header-text-dark);
}

.day-title { color: var(--header-text-light); }
.dark .day-title { color: var(--header-text-dark); }

.progress-bar-bg { background-color: #e5e7eb; }
.dark .progress-bar-bg { background-color: #374151; }
.progress-bar-fill {
    background-image: linear-gradient(var(--gradient-angle), var(--gradient-start), var(--gradient-end));
    transition: width 0.5s ease-in-out;
}

.modal {
    background-color: rgba(0, 0, 0, 0.3);
    animation: fadeIn 0.3s ease;
}
.dark .modal { background-color: rgba(15, 23, 42, 0.5); }
.modal-content { animation: scaleUp 0.3s ease; }

/* --- ANIMATIONS ( floatUp is now smoother) --- */
@keyframes floatUp {
    from { opacity: 0; transform: translateY(30px); }
    to { opacity: 1; transform: translateY(0); }
}
@keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
@keyframes scaleUp { from { transform: scale(0.95); opacity: 0; } to { transform: scale(1); opacity: 1; } }
@keyframes rotate-background {
    from { transform: translate(-50%, -50%) rotate(0deg); }
    to { transform: translate(-50%, -50%) rotate(360deg); }
}

#toast-container { position: fixed; bottom: 1.5rem; right: 1.5rem; z-index: 100; display: flex; flex-direction: column; gap: 0.75rem; }
.toast { padding: 1rem; border-radius: 0.75rem; color: white; font-weight: 600; box-shadow: 0 4px 6px rgba(0,0,0,0.1); opacity: 0; transform: translateX(100%); animation: slideIn 0.5s forwards, fadeOut 0.5s 4.5s forwards; }
.toast.success { background-image: linear-gradient(var(--gradient-angle), #22c55e, #16a34a); }
.toast.error { background-image: linear-gradient(var(--gradient-angle), var(--gradient-danger-start), var(--gradient-danger-end)); }
.toast.info { background-image: linear-gradient(var(--gradient-angle), #3b82f6, #2563eb); }
@keyframes slideIn { to { opacity: 1; transform: translateX(0); } }
@keyframes fadeOut { from { opacity: 1; } to { opacity: 0; transform: translateX(100%); } }

.collapsible-content, .collapsed-summary { transition: all 0.3s ease-in-out; overflow: hidden; }
.card[data-collapsed="true"] .collapsible-content { display: none; }
.card[data-collapsed="false"] .collapsed-summary { display: none; }
.collapse-icon { transition: transform 0.3s ease; }
.card[data-collapsed="true"] .collapse-icon { transform: rotate(-90deg); }

/* --- BUTTON STYLES (Primary and Danger buttons updated) --- */
.btn { display: inline-flex; align-items: center; justify-content: center; padding: 0.625rem 1.25rem; border-radius: 0.75rem; font-weight: 600; color: var(--button-text-light); transition: all 0.3s ease; border: none; cursor: pointer; box-shadow: 0 4px 15px rgba(0,0,0,0.1); }
.btn-primary { background-image: linear-gradient(var(--gradient-angle), var(--gradient-start), var(--gradient-end)); }
.btn-primary:hover { transform: translateY(-3px); box-shadow: 0 8px 25px color-mix(in srgb, var(--gradient-end) 30%, transparent); }
.btn-secondary { background-color: #64748b; } .btn-secondary:hover { background-color: #475569; transform: translateY(-2px); box-shadow: 0 4px 8px rgba(0,0,0,0.2); }
.btn-success { background-color: #22c55e; } .btn-success:hover { background-color: #16a34a; transform: translateY(-2px); }
.btn-danger { background-image: linear-gradient(var(--gradient-angle), var(--gradient-danger-start), var(--gradient-danger-end)); }
.btn-danger:hover { transform: translateY(-3px); box-shadow: 0 8px 25px color-mix(in srgb, var(--gradient-danger-end) 30%, transparent); }
.btn-info { background-color: #3b82f6; } .btn-info:hover { background-color: #2563eb; transform: translateY(-2px); }
.btn-warning { background-color: #f59e0b; } .btn-warning:hover { background-color: #d97706; transform: translateY(-2px); }

.control-btn { padding: 0.5rem; border-radius: 9999px; transition: background-color 0.2s, transform 0.3s ease; }
.control-btn:hover { background-color: color-mix(in srgb, var(--gradient-start) 10%, transparent); transform: scale(1.1) rotate(15deg); }
.dark .control-btn:hover { background-color: rgba(255,255,255,0.1); }

.view-switcher .btn-secondary { background: transparent; color: var(--text-light); border: 1px solid var(--border-light); }
.dark .view-switcher .btn-secondary { color: var(--text-dark); border-color: var(--border-dark); }
.dark .view-switcher .btn-secondary:hover { background: var(--card-bg-dark); }

.timer-button { transition: background-color 0.3s, transform 0.2s; }
.timer-button:hover { transform: scale(1.05); }
.timer-button.start-btn { background-color: #22c55e; } .timer-button.start-btn:hover { background-color: #16a34a; }
.timer-button.pause-btn { background-color: #f97316; } .timer-button.pause-btn:hover { background-color: #ea580c; }
.timer-button.reset-btn { background-color: #ef4444; } .timer-button.reset-btn:hover { background-color: #dc2626; }

.lessons-container.drag-over { background-color: rgba(99, 102, 241, 0.1); border-radius: 0.75rem; }
.dark .lessons-container.drag-over { background-color: rgba(168, 85, 247, 0.1); }

/* Monthly View Styles */
.monthly-calendar { display: grid; grid-template-columns: repeat(7, 1fr); gap: 0.5rem; }
.monthly-day-header { font-weight: 600; text-align: center; padding: 0.5rem; border-radius: 0.5rem; background-color: rgba(0,0,0,0.05); }
.dark .monthly-day-header { background-color: rgba(255,255,255,0.05); }
.monthly-day-cell { min-height: 100px; border-radius: 0.75rem; display: flex; flex-direction: column; padding: 0.5rem; transition: transform 0.2s ease, box-shadow 0.2s ease; position: relative; }
.monthly-day-cell.plan-day { background-color: var(--card-bg-light); border: 1px solid var(--border-light); cursor: pointer; }
.dark .monthly-day-cell.plan-day { background-color: var(--card-bg-dark); border-color: var(--border-dark); }
.monthly-day-cell.plan-day:hover { transform: scale(1.05); box-shadow: 0 4px 12px rgba(0,0,0,0.1); z-index: 10; }
.monthly-day-cell .day-number { font-weight: 600; }
.monthly-day-cell.completed { background-color: rgba(34, 197, 94, 0.2); border-color: #22c55e; }
.dark .monthly-day-cell.completed { background-color: rgba(34, 197, 94, 0.2); border-color: #22c55e; }
.monthly-day-cell .subject-tag { font-size: 0.75rem; padding: 0.125rem 0.5rem; border-radius: 9999px; color: white; margin-top: 0.25rem; font-weight: 600; }
.monthly-day-cell .lesson-count { font-size: 0.75rem; margin-top: auto; align-self: flex-end; opacity: 0.7; }

/* File Management & General UI */
.btn-files { background: none; border: none; cursor: pointer; padding: 0.25rem; border-radius: 9999px; transition: background-color 0.2s, color 0.2s; }
.btn-files:hover { background-color: rgba(0,0,0,0.1); }
.dark .btn-files:hover { background-color: rgba(255,255,255,0.1); }
.file-item .file-link { color: var(--gradient-start); text-decoration: underline; word-break: break-all; }

/* Picture-in-Picture Button */
.pip-btn { background: none; border: none; cursor: pointer; color: var(--text-light); opacity: 0.6; transition: opacity 0.2s, color 0.2s; }
.dark .pip-btn { color: var(--text-dark); }
.pip-btn:hover { opacity: 1; color: var(--gradient-start); }

/* Active Timer Glow Effect (Updated color) */
.lesson-entry.active-timer { animation: pulse-glow 2s infinite ease-in-out; }
@keyframes pulse-glow {
    0%, 100% { box-shadow: 0 0 0 0 rgba(168, 85, 247, 0); }
    50% { box-shadow: 0 0 10px 2px rgba(168, 85, 247, 0.4); }
}

/* Remove default date/number input styles */
input[type="date"]::-webkit-calendar-picker-indicator { filter: invert(0.5); }

/* --- LAYOUT STYLES --- */
body { background-color: var(--bg-light); }
.dark body { background-color: var(--bg-dark); }

.app-grid {
    display:grid;
    grid-template-columns: 1fr;
    height: calc(100vh - 2rem);
    gap: 0;
}

/* Sidebar now has a glassy effect */
.sidebar {
    border-right: 1px solid var(--border-light);
    background-color: var(--card-bg-light); /* Changed for glass effect */
    backdrop-filter: blur(20px);
    -webkit-backdrop-filter: blur(20px);
}
.dark .sidebar {
    border-right-color: var(--border-dark);
    background-color: var(--card-bg-dark); /* Changed for glass effect */
}

.main-content, .sidebar { overflow-y: auto; }

/* Desktop layout: Two columns */
@media (min-width: 768px) {
    .app-grid { grid-template-columns: 320px 1fr; }
}

/* Remove border and background from the main container itself */
.main-container {
    border: none;
    background-color: transparent;
    padding: 0;
    border-radius: 1.5rem;
    overflow: hidden; /* Clips the child elements to the rounded corners */
}
.dark .main-container { border: none; background-color: transparent; }

/* --- ANALYTICS FILTER STYLES --- */
.analytics-filters { position: relative; z-index: 20; }
.multiselect-dropdown { position: relative; }
.multiselect-dropdown .options {
    position: absolute;
    top: 100%;
    left: 0;
    right: 0;
    background-color: var(--card-bg-light); /* Glassy dropdown */
    backdrop-filter: blur(20px);
    -webkit-backdrop-filter: blur(20px);
    border: 1px solid var(--border-light);
    border-radius: 0.75rem;
    z-index: 50;
    max-height: 200px;
    overflow-y: auto;
    margin-top: 0.25rem;
}
.dark .multiselect-dropdown .options {
    background-color: var(--card-bg-dark);
    border: 1px solid var(--border-dark);
}
.multiselect-dropdown .option {
    padding: 0.5rem;
    cursor: pointer;
    display: flex;
    align-items: center;
    color: var(--text-light);
}
.dark .multiselect-dropdown .option { color: var(--text-dark); }
.multiselect-dropdown .option:hover { background-color: rgba(0, 0, 0, 0.05); }
.dark .multiselect-dropdown .option:hover { background-color: rgba(255, 255, 255, 0.1); }
.multiselect-dropdown .option input { margin-right: 0.5rem; }

/* --- LESSON BANK PICKER STYLES --- */
.lesson-picker-item .lesson-header { display: flex; justify-content: space-between; align-items: center; padding: 0.5rem 0.75rem; cursor: pointer; border-radius: 0.375rem; transition: background-color 0.2s; }
.lesson-picker-item .lesson-header:hover { background-color: rgba(0,0,0,0.05); }
.dark .lesson-picker-item .lesson-header:hover { background-color: rgba(255,255,255,0.07); }
.lesson-picker-item .subtopic-picker-list { display: none; padding-left: 1rem; margin-top: 0.5rem; border-left: 2px solid var(--border-light); }
.dark .lesson-picker-item .subtopic-picker-list { border-left-color: var(--border-dark); }
.lesson-picker-item .subtopic-picker-list.open { display: block; }
.lesson-picker-item .subtopic-picker-list label { display: flex; align-items: center; padding: 0.375rem; cursor: pointer; border-radius: 0.25rem; }
.lesson-picker-item .subtopic-picker-list label:hover { background-color: rgba(0,0,0,0.05); }
.dark .lesson-picker-item .subtopic-picker-list label:hover { background-color: rgba(255,255,255,0.1); }
.lesson-picker-item .subtopic-picker-list input[type="checkbox"] { margin-right: 0.75rem; width: 1rem; height: 1rem; }
.lesson-picker-item .select-all-label { font-size: 0.75rem; font-weight: 600; opacity: 0.8; }

/* --- KANBAN VIEW STYLES --- */
.kanban-board-container { display: flex; gap: 1rem; align-items: flex-start; padding-bottom: 1rem; }
.kanban-column {
    flex: 0 0 320px;
    max-width: 320px;
    display: flex;
    flex-direction: column;
    max-height: 100%;
    /* Inherits glassy style from .glass-card */
}
.kanban-column-header { padding: 0.75rem; font-weight: 700; text-transform: uppercase; letter-spacing: 0.05em; border-bottom: 1px solid var(--border-light); }
.dark .kanban-column-header { border-bottom-color: var(--border-dark); }
.kanban-cards { flex-grow: 1; padding: 0.75rem; overflow-y: auto; display: flex; flex-direction: column; gap: 0.75rem; min-height: 100px; }
.kanban-cards .lesson-entry { background-color: var(--card-bg-light); border-radius: 0.75rem; box-shadow: 0 4px 10px rgba(0,0,0,0.05); }
.dark .kanban-cards .lesson-entry { background-color: var(--card-bg-dark); }
.kanban-column .add-lesson-btn { margin: 0.75rem; flex-shrink: 0; }
.kanban-cards.drag-over { background-color: rgba(99, 102, 241, 0.1); }
.dark .kanban-cards.drag-over { background-color: rgba(168, 85, 247, 0.1); }